// Smarter logic for non-tabular financial data (e.g., Min Amt for New Policy)
function findCellBelowHeader(
  data: (string | number | boolean)[][],
  rowLabel: string,
  columnLabel: string
): string {
  const targetRowLabel = rowLabel.toLowerCase().trim();
  const targetColumnLabel = columnLabel.toLowerCase().trim();

  let headerRowIndex = -1;
  let colIndex = -1;

  for (let i = 0; i < data.length; i++) {
    const row = data[i];
    for (let j = 0; j < row.length; j++) {
      const cell = row[j]?.toString().toLowerCase().trim();
      if (cell === targetColumnLabel) {
        headerRowIndex = i;
        colIndex = j;
        break;
      }
    }
    if (headerRowIndex !== -1) break;
  }

  if (headerRowIndex === -1 || colIndex === -1) return '';

  for (let i = headerRowIndex + 1; i < data.length; i++) {
    const row = data[i];
    const firstCol = row[0]?.toString().toLowerCase().trim();
    if (firstCol === targetRowLabel) {
      return row[colIndex]?.toString().trim() ?? '';
    }
  }

  return '';
}


const financialExtractedData = financialHeadersMap.map(obj => {
  if (obj.ExcelLabel && obj.propertyName) {
    return findCellBelowHeader(financialData, obj.ExcelLabel, obj.propertyName);
  } else {
    return findMetadataValue(financialData, obj.ExcelLabel.trim());
  }
});
